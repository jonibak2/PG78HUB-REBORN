<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–•–æ—Å—Ç –ú–∞—Ñ–∏–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <style>
      :root {
        --accent: #ff6b6b;
        --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #fd588a 100%);
        --card-bg: #ffffff;
        --bg: linear-gradient(135deg, #f5f5f5 0%, #e8f0f0 100%);

        /* –¶–≤–µ—Ç–∞ —Ä–æ–ª–µ–π */
        --role-mirny: #e6f0ff;
        --role-mafia: #ffe6e6;
        --role-don: #fff0e6;
        --role-komissar: #fffbe6;
        --role-doctor: #e6ffe6;
        --role-putana: #f9e6ff;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }
      html, body {
        height: 100%;
        font-family: system-ui, -apple-system, sans-serif;
        background: var(--bg);
        overflow: hidden;
      }

      body {
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        gap: 1.5rem;
      }

      .main-container {
        display: flex;
        gap: 2rem;
        flex: 1;
        min-height: 0;
        position: relative;
      }

      #hurry-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: url('rabbit.png') center/cover no-repeat;
        opacity: 0.15;
        pointer-events: none;
        z-index: 1000;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      #hurry-text {
        font-size: 6vw;
        font-weight: bold;
        color: #ff0000;
        text-shadow: 0 0 20px white;
        background: rgba(0,0,0,0.5);
        padding: 1rem 3rem;
        border-radius: 20px;
      }

      .left-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-width: 0;
      }

      .control-panel {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      }

      .control-panel h2 {
        text-align: center;
        margin-bottom: 1rem;
        color: var(--accent);
        font-size: 1.4rem;
      }

      .button-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.8rem;
      }

      button {
        background: var(--accent-gradient);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        transition: all 0.3s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255,107,107,0.4);
      }

      .reset-votes {
        background: linear-gradient(135deg, #f86a6c 0%, #ff8a8c 100%);
      }

      .players-list {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      }

      .player {
        display: flex;
        align-items: center;
        padding: 1.2rem 1.5rem;
        gap: 1rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
      }

      .player:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(255,107,107,0.15);
      }

      .player[data-role="–ú–∏—Ä–Ω—ã–π"]   { background: var(--role-mirny); }
      .player[data-role="–ú–∞—Ñ–∏—è"]    { background: var(--role-mafia); }
      .player[data-role="–î–æ–Ω"]      { background: var(--role-don); }
      .player[data-role="–ö–æ–º–∏—Å—Å–∞—Ä"] { background: var(--role-komissar); }
      .player[data-role="–î–æ–∫—Ç–æ—Ä"]   { background: var(--role-doctor); }
      .player[data-role="–ü—É—Ç–∞–Ω–∞"]   { background: var(--role-putana); }

      .player.dead {
        opacity: 0.5;
        filter: grayscale(100%);
        background: #e0e0e0 !important;
      }

      .player-number {
        font-weight: bold;
        font-size: 1.4rem;
        width: 2.8rem;
        height: 2.8rem;
        background: var(--accent-gradient);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .player-number:hover {
        transform: scale(1.1);
      }

      input[type="text"] {
        flex: 1;
        padding: 0.9rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1.1rem;
      }

      input[type="text"]:focus {
        border-color: var(--accent);
        outline: none;
      }

      select {
        padding: 0.9rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        min-width: 150px;
        font-size: 1rem;
      }

      select:focus {
        border-color: var(--accent);
        outline: none;
      }

      .vote-checks {
        display: flex;
        gap: 0.6rem;
        flex-wrap: wrap;
        margin-left: auto;
      }

      .vote-check {
        width: 24px;
        height: 24px;
        accent-color: var(--accent);
        cursor: pointer;
      }

      .right-panel {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        width: 380px;
        flex-shrink: 0;
      }

      .cheatsheet {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .cheatsheet h2 {
        text-align: center;
        margin-bottom: 1rem;
        color: var(--accent);
        font-size: 1.4rem;
      }

      .cheatsheet ul {
        margin: 0.8rem 0;
        padding-left: 1.4rem;
        flex-grow: 1;
        overflow-y: auto;
      }

      .cheatsheet li {
        margin-bottom: 0.6rem;
        line-height: 1.5;
      }

      .sleep-visual {
        color: #888;
        font-style: italic;
      }

      /* ==================== –°–¢–ò–õ–ò –¢–ê–ô–ú–ï–†–ê ==================== */
      #time-select {
        padding: 10px;
        font-size: 16px;
        width: 160px;
        border: 2px solid #c39fe0;
        border-radius: 5px;
        background-color: #fff;
        cursor: pointer;
      }

      .timer-controls button {
        padding: 10px 20px;
        font-size: 16px;
        color: #fff;
        background-color: #c39fe0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 8px 5px;
        transition: all 0.3s ease;
      }

      .timer-controls button:hover {
        transform: scale(1.05);
      }

      #timer-reset { background-color: #1e90ff; }
      #timer-close { background-color: #ff6347; }

      .timer-container { margin-bottom: 20px; }

      .countdown__container {
        position: relative;
        width: var(--size, 400px);
        height: var(--size, 400px);
      }

      .countdown__progress {
        stroke: var(--color, #ff6347);
        stroke-dasharray: var(--circumference);
        stroke-dashoffset: 0;
        fill: none;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.95s linear;
        border: 2px solid black;
      }

      .countdown__background {
        stroke: var(--background-color, #f0f0f0);
        fill: none;
      }

      .countdown__text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: calc(var(--size) / 2 * var(--font-size));
        color: var(--color, #ff6347);
        font-weight: bold;
      }

      .countdown__video {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: calc(var(--size) * 0.8);
        height: calc(var(--size) * 0.8);
        border-radius: 50%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        pointer-events: none;
      }

      .countdown__video.show { opacity: 1; }

      /* ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –° –ü–õ–ê–í–ù–û–ô –ê–ù–ò–ú–ê–¶–ò–ï–ô ==================== */
      #timer-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 10000;
        flex-direction: column;
        align-items: center;
        pointer-events: none;
      }

      #timer-modal.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
        pointer-events: auto;
      }

      /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–∞–π–º–µ—Ä–∞ */
      #open-timer-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        padding: 15px 30px;
        font-size: 1.3rem;
        background: var(--accent-gradient);
        box-shadow: 0 4px 15px rgba(255,107,107,0.4);
      }

      @media (max-width: 1100px) {
        .main-container { flex-direction: column; }
        .right-panel { width: 100%; flex-direction: row; gap: 2rem; }
        .cheatsheet { flex: 1; max-width: 600px; }
      }

      @media (max-width: 768px) {
        .right-panel { flex-direction: column; }
      }

      /* ==================== –ö–ê–†–£–°–ï–õ–¨ –í–´–ë–û–†–ê –ò–ì–†–û–ö–ê ==================== */
      .player-selector-popup {
        position: fixed;
        display: none;
        z-index: 5000;
        pointer-events: none;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .player-selector-popup.active {
        pointer-events: auto;
      }

      .player-selector-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.4);
        display: none;
        z-index: 4999;
      }

      .player-selector-overlay.active { display: block; }

      .circle-container { position: relative; width: 400px; height: 400px; }

      .center {
        position: absolute;
        top: 50%; left: 38%;
        transform: translate(-50%, -50%);
        width: 100px; height: 100px;
        border-radius: 50%;
        overflow: hidden;
        background: #222;
        box-shadow: 0 6px 20px rgba(0,0,0,0.8);
        cursor: pointer;
        transition: transform 0.4s ease;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.9rem;
        text-align: center;
        padding: 1rem;
      }

      .circle-container:hover .center { transform: translate(-50%, -50%) scale(1.15); }

      .center img { width: 100%; height: 100%; object-fit: cover; }

      .member {
        position: absolute;
        width: 70px; height: 70px;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.6);
        opacity: 0;
        visibility: hidden;
        transform: scale(0.3);
        transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 10;
        cursor: pointer;
        background: #222;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
        text-align: center;
      }

      .member img { width: 100%; height: 100%; object-fit: cover; }

      .circle-container:hover .member {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
      }

      .member:hover {
        transform: scale(1.2) !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.9);
        z-index: 30;
      }

      .member::after {
        content: attr(data-name);
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.95);
        color: #fff;
        padding: 6px 14px;
        border-radius: 8px;
        font-size: 13px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      .member:hover::after { opacity: 1; }

      /* –ü–æ–∑–∏—Ü–∏–∏ –¥–ª—è 14 —á–µ–ª–æ–≤–µ–∫ */
      .member:nth-child(2) { top: 15px; left: 165px; }
      .member:nth-child(3) { top: 35px; left: 255px; }
      .member:nth-child(4) { top: 90px; left: 310px; }
      .member:nth-child(5) { top: 165px; left: 325px; }
      .member:nth-child(6) { top: 245px; left: 310px; }
      .member:nth-child(7) { top: 310px; left: 255px; }
      .member:nth-child(8) { top: 350px; left: 165px; }
      .member:nth-child(9) { top: 350px; left: 75px; }
      .member:nth-child(10) { top: 310px; left: -15px; }
      .member:nth-child(11) { top: 245px; left: -70px; }
      .member:nth-child(12) { top: 165px; left: -85px; }
      .member:nth-child(13) { top: 90px; left: -70px; }
      .member:nth-child(14) { top: 35px; left: -15px; }
      .member:nth-child(15) { top: 15px; left: 75px; }
    </style>
  </head>
  <body>

    <div id="hurry-overlay">
      <div id="hurry-text">–û—Å—Ç–∞–ª–æ—Å—å 10 —Å–µ–∫—É–Ω–¥!</div>
    </div>

    <div class="main-container">
      <div class="left-panel">
        <div id="control-panel" class="control-panel">
          <h2>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</h2>
          <div class="button-group">
            <button onclick="addPlayer()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
            <button onclick="setPlayerCount(6)">6 –∏–≥—Ä–æ–∫–æ–≤</button>
            <button onclick="setPlayerCount(8)">8 –∏–≥—Ä–æ–∫–æ–≤</button>
            <button onclick="setPlayerCount(10)">10 –∏–≥—Ä–æ–∫–æ–≤</button>
            <button onclick="setPlayerCount(12)">12 –∏–≥—Ä–æ–∫–æ–≤</button>
            <button onclick="resetVotes()" class="reset-votes">–°–±—Ä–æ—Å–∏—Ç—å –≥–æ–ª–æ—Å–∞</button>
          </div>
        </div>

        <div id="players" class="players-list"></div>
      </div>

      <div class="right-panel">
        <div class="cheatsheet">
          <h2>üìã –®–ø–∞—Ä–≥–∞–ª–∫–∞</h2>
          <p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–æ–ª–∏:</strong></p>
          <ul>
            <li><strong>6 –∏–≥—Ä–æ–∫–æ–≤:</strong> <span style="color: #ff4d4d">1 –º–∞—Ñ–∏–æ–∑–∏</span>, <span style="color: #ff6600">1 –¥–æ–Ω</span>, <span style="color: #ffcc00">1 –∫–æ–º–∏—Å—Å–∞—Ä</span>, <span style="color: #4dff88">1 –¥–æ–∫—Ç–æ—Ä</span>, <span style="color: #4da6ff">2 –º–∏—Ä–Ω—ã—Ö</span></li>
            <li><strong>8 –∏–≥—Ä–æ–∫–æ–≤:</strong> <span style="color: #ff4d4d">2 –º–∞—Ñ–∏–æ–∑–∏</span>, <span style="color: #ff6600">1 –¥–æ–Ω</span>, <span style="color: #ffcc00">1 –∫–æ–º–∏—Å—Å–∞—Ä</span>, <span style="color: #4dff88">1 –¥–æ–∫—Ç–æ—Ä</span>, <span style="color: #4da6ff">3 –º–∏—Ä–Ω—ã—Ö</span></li>
            <li><strong>10 –∏–≥—Ä–æ–∫–æ–≤:</strong> <span style="color: #ff4d4d">2 –º–∞—Ñ–∏–æ–∑–∏</span>, <span style="color: #ff6600">1 –¥–æ–Ω</span>, <span style="color: #ffcc00">1 –∫–æ–º–∏—Å—Å–∞—Ä</span>, <span style="color: #4dff88">1 –¥–æ–∫—Ç–æ—Ä</span>, <span style="color: #4da6ff">4 –º–∏—Ä–Ω—ã—Ö</span>, <span style="color: #cc66ff">1 –ø—É—Ç–∞–Ω–∞</span></li>
            <li><strong>12 –∏–≥—Ä–æ–∫–æ–≤:</strong> <span style="color: #ff4d4d">3 –º–∞—Ñ–∏–æ–∑–∏</span>, <span style="color: #ff6600">1 –¥–æ–Ω</span>, <span style="color: #ffcc00">1 –∫–æ–º–∏—Å—Å–∞—Ä</span>, <span style="color: #4dff88">1 –¥–æ–∫—Ç–æ—Ä</span>, <span style="color: #4da6ff">5 –º–∏—Ä–Ω—ã—Ö</span>, <span style="color: #cc66ff">1 –ø—É—Ç–∞–Ω–∞</span></li>
          </ul>
          <p><strong>–ù–æ—á—å:</strong></p>
          <ul>
            <li>–í—Å–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç –≥–ª–∞–∑–∞</li>
            <li>üü™ –ü—É—Ç–∞–Ω–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –≤—ã–±–∏—Ä–∞–µ—Ç, –∫–æ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</li>
            <li><span class="sleep-visual">–ü—É—Ç–∞–Ω–∞ –∑–∞—Å—ã–ø–∞–µ—Ç</span></li>
            <li>üü• –ú–∞—Ñ–∏—è –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –∂–µ—Ä—Ç–≤—É; üüß –î–æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–≥—Ä–æ–∫–∞</li>
            <li><span class="sleep-visual">–ú–∞—Ñ–∏—è –∏ –î–æ–Ω –∑–∞—Å—ã–ø–∞—é—Ç</span></li>
            <li>üü® –ö–æ–º–∏—Å—Å–∞—Ä –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É</li>
            <li><span class="sleep-visual">–ö–æ–º–∏—Å—Å–∞—Ä –∑–∞—Å—ã–ø–∞–µ—Ç</span></li>
            <li>üü© –î–æ–∫—Ç–æ—Ä –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ –≤—ã–±–∏—Ä–∞–µ—Ç, –∫–æ–≥–æ –ª–µ—á–∏—Ç—å</li>
            <li><span class="sleep-visual">–î–æ–∫—Ç–æ—Ä –∑–∞—Å—ã–ø–∞–µ—Ç</span></li>
            <li>–í—Å–µ –ø—Ä–æ—Å—ã–ø–∞—é—Ç—Å—è. –°–µ–≥–æ–¥–Ω—è —É–±–∏—Ç...</li>
          </ul>
          <p><strong>–î–µ–Ω—å:</strong></p>
          <ul>
            <li>–û–±—Å—É–∂–¥–µ–Ω–∏–µ</li>
            <li>–í—ã–¥–≤–∏–∂–µ–Ω–∏–µ</li>
            <li>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ —Å–∫–∏–ø–Ω—É—Ç—å –≤ –ø–µ—Ä–≤—É—é –Ω–æ—á—å, –Ω–æ –≤–æ –≤—Ç–æ—Ä—É—é –∫–∏–∫–Ω—É—Ç—å –¥–≤—É—Ö)</li>
            <li>–û–±—ä—è–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –≤—ã–±—ã–≤—à–µ–≥–æ (–ï—Å–ª–∏ –∏–≥—Ä–∞–µ—Ç–µ –ø–æ —Ç–∞–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º)</li>
          </ul>
        </div>
      </div>
    </div>

    <button id="open-timer-btn" onclick="openTimerModal()">‚è± –¢–∞–π–º–µ—Ä</button>

    <!-- –ü–ª–∞–≤–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–∞–π–º–µ—Ä–∞ -->
    <div id="timer-modal">
      <div class="timer-container"></div>
      <select id="time-select">
        <option value="30">30 —Å–µ–∫—É–Ω–¥</option>
        <option value="60" selected>1 –º–∏–Ω—É—Ç–∞</option>
        <option value="120">2 –º–∏–Ω—É—Ç—ã</option>
        <option value="180">3 –º–∏–Ω—É—Ç—ã</option>
        <option value="300">5 –º–∏–Ω—É—Ç</option>
      </select>
      <div class="timer-controls">
        <button id="play-pause">–°—Ç–∞—Ä—Ç</button>
        <button id="timer-reset">–°–±—Ä–æ—Å</button>
        <button id="timer-close" onclick="closeTimerModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>

    <audio id="kill-sound" src="kill.mp3"></audio>

    <div class="player-selector-overlay" id="selectorOverlay"></div>
    <div class="player-selector-popup" id="selectorPopup">
      <div class="circle-container" id="circleContainer">
        <div class="center" id="centerDisplay">–í—ã–±–æ—Ä</div>
      </div>
    </div>

    <script>
      /* ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ==================== */
      const playersDiv = document.getElementById("players");
      const killSound = document.getElementById("kill-sound");
      const selectorPopup = document.getElementById("selectorPopup");
      const selectorOverlay = document.getElementById("selectorOverlay");
      const circleContainer = document.getElementById("circleContainer");
      const centerDisplay = document.getElementById("centerDisplay");
      let currentSelectedPlayerDiv = null;

      const availablePeople = [
        { name: "–≠—Ä–∏—Å—Çorem", avatar: "assets/pgCALENDAR/eristorem.png" },
        { name: "–•–æ–º–∞", avatar: "assets/pgCALENDAR/homa.png" },
        { name: "–ú–æ–¥–∏", avatar: "assets/pgCALENDAR/modie.png" },
        { name: "–ü–∞—à–æ–∫", avatar: "assets/pgCALENDAR/pasha.png" },
        { name: "–≠–Ω–¥", avatar: "assets/pgCALENDAR/fayko.jpg" },
        { name: "–ê–Ω—è", avatar: "assets/pgCALENDAR/anya.png" },
        { name: "–°—Ç–∞—Å–∏–∫", avatar: "assets/pgCALENDAR/nicech.png" },
        { name: "–ù–∏–∫–∞", avatar: "assets/pgCALENDAR/nika.png" },
        { name: "–ö–æ—Å—Ç—è", avatar: "assets/pgCALENDAR/kostya.png" },
        { name: "–ï—Ä–∂–∞–Ω", avatar: "assets/pgCALENDAR/erzhan.png" },
        { name: "–î—Ä–∞–≥–æ–º–∞–Ω", avatar: "assets/pgCALENDAR/dragoman.png" },
        { name: "–ê–Ω–¥—Ä–µ–π", avatar: "assets/pgCALENDAR/andrew.png" },
        { name: "–ñ–∞–Ω–∏–±–µ–∫", avatar: "assets/pgCALENDAR/jonibak.png" },
        { name: "–ú–æ—Ä–∏–Ω–æ–∫", avatar: "assets/pgCALENDAR/morinok.png" }
      ];

      function createMemberElements() {
        const oldMembers = circleContainer.querySelectorAll(".member");
        oldMembers.forEach(el => el.remove());

        availablePeople.forEach((person) => {
          const memberDiv = document.createElement("div");
          memberDiv.className = "member";
          memberDiv.dataset.name = person.name;

          const img = document.createElement("img");
          img.src = person.avatar;
          img.alt = person.name;
          memberDiv.appendChild(img);

          memberDiv.onclick = (e) => {
            e.stopPropagation();
            selectMember(person.name);
          };

          circleContainer.appendChild(memberDiv);
        });
      }

      function showPlayerSelector(playerDiv) {
        currentSelectedPlayerDiv = playerDiv;
        createMemberElements();
        selectorOverlay.classList.add("active");
        selectorPopup.classList.add("active");
        selectorPopup.style.display = "block";
      }

      function hidePlayerSelector() {
        selectorOverlay.classList.remove("active");
        selectorPopup.classList.remove("active");
        selectorPopup.style.display = "none";
        currentSelectedPlayerDiv = null;
      }

      function selectMember(name) {
        if (currentSelectedPlayerDiv) {
          const nameInput = currentSelectedPlayerDiv.querySelector('input[type="text"]');
          if (nameInput) nameInput.value = name;
        }
        hidePlayerSelector();
      }

      selectorOverlay.onclick = hidePlayerSelector;

      function addPlayer(number) {
        const div = document.createElement("div");
        div.className = "player";

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "‚úï";
        deleteBtn.style.padding = "6px 10px";
        deleteBtn.style.marginRight = "12px";
        deleteBtn.style.fontSize = "1.2rem";
        deleteBtn.onclick = () => {
          div.remove();
          renumberPlayers();
        };

        const numSpan = document.createElement("div");
        numSpan.className = "player-number";
        numSpan.textContent = number !== undefined ? number + 1 : playersDiv.children.length + 1;
        numSpan.onclick = (e) => {
          e.stopPropagation();
          showPlayerSelector(div);
        };

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "–ò–º—è –∏–≥—Ä–æ–∫–∞";

        const roleSelect = document.createElement("select");
        roleSelect.className = "role-select";
        [
          { value: "–ú–∏—Ä–Ω—ã–π", label: "üü¶ –ú–∏—Ä–Ω—ã–π" },
          { value: "–ú–∞—Ñ–∏—è", label: "üü• –ú–∞—Ñ–∏—è" },
          { value: "–î–æ–Ω", label: "üüß –î–æ–Ω" },
          { value: "–ö–æ–º–∏—Å—Å–∞—Ä", label: "üü® –ö–æ–º–∏—Å—Å–∞—Ä" },
          { value: "–î–æ–∫—Ç–æ—Ä", label: "üü© –î–æ–∫—Ç–æ—Ä" },
          { value: "–ü—É—Ç–∞–Ω–∞", label: "üü™ –ü—É—Ç–∞–Ω–∞" },
        ].forEach((role) => {
          const opt = document.createElement("option");
          opt.value = role.value;
          opt.textContent = role.label;
          roleSelect.appendChild(opt);
        });

        roleSelect.onchange = () => div.dataset.role = roleSelect.value;

        const statusSelect = document.createElement("select");
        statusSelect.className = "status-select";
        [
          { value: "–ñ–∏–≤", label: "üü¢ –ñ–∏–≤" },
          { value: "–ú—ë—Ä—Ç–≤", label: "üî¥ –ú—ë—Ä—Ç–≤" },
        ].forEach((status) => {
          const opt = document.createElement("option");
          opt.value = status.value;
          opt.textContent = status.label;
          statusSelect.appendChild(opt);
        });

        statusSelect.onchange = () => {
          if (statusSelect.value === "–ú—ë—Ä—Ç–≤") {
            div.classList.add("dead");
            killSound.currentTime = 0;
            killSound.play().catch(() => {});
          } else {
            div.classList.remove("dead");
          }
        };

        const votesDiv = document.createElement("div");
        votesDiv.className = "vote-checks";
        for (let i = 0; i < 12; i++) {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "vote-check";
          votesDiv.appendChild(checkbox);
        }

        div.appendChild(deleteBtn);
        div.appendChild(numSpan);
        div.appendChild(nameInput);
        div.appendChild(roleSelect);
        div.appendChild(statusSelect);
        div.appendChild(votesDiv);

        div.dataset.role = "–ú–∏—Ä–Ω—ã–π";
        playersDiv.appendChild(div);
      }

      function renumberPlayers() {
        const players = playersDiv.children;
        for (let i = 0; i < players.length; i++) {
          players[i].querySelector('.player-number').textContent = i + 1;
        }
      }

      function distributeRoles(count) {
        const roleSelects = document.querySelectorAll('.role-select');
        let roles = [];
        if (count === 6) roles = ['–ú–∞—Ñ–∏—è', '–î–æ–Ω', '–ö–æ–º–∏—Å—Å–∞—Ä', '–î–æ–∫—Ç–æ—Ä', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π'];
        else if (count === 8) roles = ['–ú–∞—Ñ–∏—è', '–ú–∞—Ñ–∏—è', '–î–æ–Ω', '–ö–æ–º–∏—Å—Å–∞—Ä', '–î–æ–∫—Ç–æ—Ä', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π'];
        else if (count === 10) roles = ['–ú–∞—Ñ–∏—è', '–ú–∞—Ñ–∏—è', '–î–æ–Ω', '–ö–æ–º–∏—Å—Å–∞—Ä', '–î–æ–∫—Ç–æ—Ä', '–ü—É—Ç–∞–Ω–∞', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π'];
        else if (count === 12) roles = ['–ú–∞—Ñ–∏—è', '–ú–∞—Ñ–∏—è', '–ú–∞—Ñ–∏—è', '–î–æ–Ω', '–ö–æ–º–∏—Å—Å–∞—Ä', '–î–æ–∫—Ç–æ—Ä', '–ü—É—Ç–∞–Ω–∞', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π', '–ú–∏—Ä–Ω—ã–π'];

        for (let i = roles.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [roles[i], roles[j]] = [roles[j], roles[i]];
        }

        roleSelects.forEach((select, index) => {
          select.value = roles[index];
          select.dispatchEvent(new Event('change'));
        });
      }

      function setPlayerCount(count) {
        playersDiv.innerHTML = "";
        for (let i = 0; i < count; i++) addPlayer(i);
        distributeRoles(count);
      }

      function resetVotes() {
        document.querySelectorAll(".vote-check").forEach(cb => cb.checked = false);
      }

      /* ==================== –ö–†–£–ì–û–í–û–ô –¢–ê–ô–ú–ï–† –° –ü–õ–ê–í–ù–û–ô –ê–ù–ò–ú–ê–¶–ò–ï–ô ==================== */
      class CountdownTimer {
        // ... (–≤–µ—Å—å –∫–ª–∞—Å—Å CountdownTimer –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏) ...
        constructor(selector, options) {
          this.defaults = {
            duration: 60,
            color: "#ff6347",
            size: 400,
            backgroundColor: "#f0f0f0",
            strokeWidth: 12,
            fontSize: 0.3,
            onComplete: null,
            onTick: null
          };
          this.settings = Object.assign({}, this.defaults, options);
          this.container = document.querySelector(selector);
          this.timeLeft = this.settings.duration;
          this.interval = null;
          this.isRunning = false;
          this.hasStarted = false;
          this.init();
        }

        init() { this.createStructure(); this.setupStyles(); this.updateButtonLabel(); }

        createStructure() {
          const { size, strokeWidth } = this.settings;
          const r = size / 2 - strokeWidth;
          const half = size / 2;

          this.container.innerHTML = `
            <div class="countdown__container">
              <svg class="countdown__circle" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                <circle class="countdown__background" cx="${half}" cy="${half}" r="${r}" stroke-width="${strokeWidth}" />
                <circle class="countdown__progress" cx="${half}" cy="${half}" r="${r}" stroke-width="${strokeWidth}" transform="rotate(-90 ${half} ${half})" />
              </svg>
              <div class="countdown__text">${this.formatTime(this.timeLeft)}</div>
              <video class="countdown__video" autoplay loop muted>
                <source src="assets/tomoko.mp4" type="video/mp4">
              </video>
            </div>
          `;

          this.progressCircle = this.container.querySelector(".countdown__progress");
          this.textElement = this.container.querySelector(".countdown__text");
          this.videoElement = this.container.querySelector(".countdown__video");
          if (this.videoElement) this.videoElement.volume = 0.1;
        }

        setupStyles() {
          const { size, color, backgroundColor, fontSize } = this.settings;
          const r = size / 2 - this.settings.strokeWidth;
          const c = 2 * Math.PI * r;
          this.container.style.setProperty("--size", `${size}px`);
          this.container.style.setProperty("--color", color);
          this.container.style.setProperty("--background-color", backgroundColor);
          this.container.style.setProperty("--font-size", fontSize);
          this.container.style.setProperty("--circumference", c);
        }

        formatTime(time) {
          const minutes = Math.floor(time / 60);
          const seconds = time % 60;
          return `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
        }

        updateCountdown() {
          const r = this.settings.size / 2 - this.settings.strokeWidth;
          const c = 2 * Math.PI * r;
          const progress = this.timeLeft / this.settings.duration;
          const dashoffset = c * (1 - progress);
          this.progressCircle.style.strokeDashoffset = dashoffset;
          this.textElement.textContent = this.formatTime(this.timeLeft);

          if (this.timeLeft <= 10 && this.timeLeft > 0) {
            if (this.videoElement) {
              this.videoElement.classList.add("show");
              if (this.isRunning && this.videoElement.paused) this.videoElement.play().catch(() => {});
            }
          } else {
            if (this.videoElement) this.videoElement.classList.remove("show");
          }

          if (this.settings.onTick) this.settings.onTick(this.timeLeft);

          if (this.timeLeft > 0) {
            this.timeLeft--;
          } else {
            clearInterval(this.interval);
            if (this.settings.onComplete) this.settings.onComplete();
          }
        }

        startCountdown() {
          if (this.interval) clearInterval(this.interval);
          this.isRunning = true;
          this.hasStarted = true;
          this.progressCircle.style.transition = "stroke-dashoffset 0.95s linear";
          this.interval = setInterval(() => this.updateCountdown(), 1000);
        }

        pause() {
          clearInterval(this.interval);
          this.isRunning = false;
          if (this.videoElement && !this.videoElement.paused) this.videoElement.pause();
        }

        resume() {
          if (this.timeLeft <= 10 && this.timeLeft > 0 && this.videoElement) this.videoElement.play().catch(() => {});
          this.startCountdown();
        }

        reset() {
          this.timeLeft = this.settings.duration;
          this.isRunning = false;
          this.hasStarted = false;
          clearInterval(this.interval);
          if (this.videoElement) {
            this.videoElement.pause();
            this.videoElement.currentTime = 0;
            this.videoElement.classList.remove("show");
          }
          this.updateCountdown();
          this.updateButtonLabel();
        }

        changeTime(time) {
          this.settings.duration = time;
          this.timeLeft = time;
          this.reset();
        }

        updateButtonLabel() {
          const button = document.getElementById("play-pause");
          if (button) {
            button.textContent = !this.hasStarted ? "–°—Ç–∞—Ä—Ç" : (this.isRunning ? "–ü–∞—É–∑–∞" : "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å");
          }
        }
      }

      let timer = null;

      function openTimerModal() {
        if (!timer) {
          timer = new CountdownTimer(".timer-container", {
            duration: 60,
            color: "#ff6347",
            size: 400,
            backgroundColor: "#f0f0f0",
            strokeWidth: 12,
            fontSize: 0.3
          });
        }
        document.getElementById("timer-modal").classList.add("active");
      }

      function closeTimerModal() {
        const modal = document.getElementById("timer-modal");
        modal.classList.remove("active");
        if (timer && timer.isRunning) timer.pause();
      }

      document.getElementById("time-select").addEventListener("change", () => {
        const newTime = parseInt(document.getElementById("time-select").value, 10);
        if (timer) timer.changeTime(newTime);
      });

      document.getElementById("play-pause").addEventListener("click", () => {
        if (!timer) openTimerModal();
        if (timer.isRunning) {
          timer.pause();
        } else {
          timer.resume();
        }
        timer.updateButtonLabel();
      });

      document.getElementById("timer-reset").addEventListener("click", () => {
        if (timer) {
          timer.reset();
          timer.updateButtonLabel();
        }
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
      document.getElementById("timer-modal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("timer-modal")) closeTimerModal();
      });
    </script>
  </body>
</html>
